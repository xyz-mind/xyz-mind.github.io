---
title: iloc对比loc
description: >-
  iloc与loc的使用范围。
author: 刘十五
date: 2025-03-11 16:56:00 +0800
categories: [Blogging, Tutorial]
tags: [Python笔记]
pin: true
media_subpath: '/posts/20250311'
---

在 Pandas 中，`iloc` 和 `loc` 是两种核心的索引方法，用于从 DataFrame 或 Series 中选取数据。它们的核心区别在于**索引的底层逻辑不同**：`iloc` 基于**位置**（整数位置），而 `loc` 基于**标签**（行/列名）。以下是详细的对比和示例：

---

### **1. 核心区别**

| **特性**       | **`iloc`**                            | **`loc`**                      |
| -------------- | ------------------------------------- | ------------------------------ |
| **索引类型**   | 基于**整数位置**（行号、列号）        | 基于**标签**（行名、列名）     |
| **输入格式**   | 整数、整数列表、切片、布尔数组        | 标签、标签列表、切片、布尔数组 |
| **端点包含性** | **不包含**结束位置（类似 Python切片） | **包含**结束标签（类似闭区间） |
| **适用范围**   | 适用于任何索引（即使索引是字符串）    | 需要明确的标签定义             |
| **性能**       | 通常略快（直接映射到内存位置）        | 稍慢（需要查找标签）           |

---

### **2. 示例对比**

#### **示例数据**

```python
import pandas as pd

data = {
    "A": [10, 20, 30, 40],
    "B": [100, 200, 300, 400],
    "C": ["X", "Y", "Z", "W"]
}

df = pd.DataFrame(data, index=["row1", "row2", "row3", "row4"])
print(df)
#       A    B  C
# row1 10  100  X
# row2 20  200  Y
# row3 30  300  Z
# row4 40  400  W
```


---

#### **场景 1：选取单行**

- **`iloc`**：用整数位置（行号从 `0` 开始）

```python
df.iloc[1]  # 选取第2行（位置1）
# 输出：
# A     20
# B    200
# C      Y
```


- **`loc`**：用行标签（这里是字符串 `"row2"`）

```python
df.loc["row2"]  # 选取标签为 "row2" 的行
# 输出同上
```


---

#### **场景 2：选取多行和多列**

- **`iloc`**：位置切片（不包含结束位置）

```python
df.iloc[1:3, 0:2]  # 行：位置1到2，列：位置0到1
#       A    B
# row2 20  200
# row3 30  300
```


- **`loc`**：标签切片（包含结束标签）

```python
df.loc["row2":"row3", "A":"B"]  # 行：row2到row3，列：A到B
#       A    B
# row2 20  200
# row3 30  300
```


---

#### **场景 3：布尔索引**

- **`iloc`**：需传入布尔数组（长度需与轴一致）

```python
mask = [False, True, True, False]
df.iloc[mask, :]  # 选取第2、3行
```


- **`loc`**：可直接用列条件生成布尔数组

```python
df.loc[df["A"] > 20, :]  # 选取 A 列大于20的行
#       A    B  C
# row3 30  300  Z
# row4 40  400  W
```


---

#### **场景 4：混合行列选择**

- **`iloc`**：用位置列表

```python
df.iloc[[0, 2], [1, 2]]  # 第1、3行，第2、3列
#        B  C
# row1  100  X
# row3  300  Z
```


- **`loc`**：用标签列表

```python
df.loc[["row1", "row3"], ["B", "C"]]
# 输出同上
```


---

### **3. 关键注意事项**

1. **索引类型决定行为**：

  - 若 DataFrame 的索引是整数，`loc` 会按标签匹配（即使标签和位置恰好相同）。

```python
df = pd.DataFrame({"A": [1, 2, 3]}, index=[10, 20, 30])
df.loc[10]  # 正确：选取标签为10的行
df.iloc[0]  # 正确：选取位置为0的行（标签为10）
```


2. **避免混用标签和位置**：

  - `df.loc[0]` 会尝试查找标签为 `0` 的行，而 `df.iloc[0]` 直接选位置为0的行。

3. **修改数据**：

  - `iloc` 和 `loc` 均可用于修改数据：

```python
df.loc["row1", "A"] = 99  # 修改标签为 "row1" 的行的列 "A"
df.iloc[0, 0] = 99        # 修改位置为0的行和列
```


---

### **4. 总结**

- **使用 `iloc` 的场景**：

  - 已知数据的具体位置（如“第2行第3列”）。

  - 需要类似 Python 切片的行为（不包含结束位置）。

  - 处理任意类型的索引（尤其是非整数索引）。

- **使用 `loc` 的场景**：

  - 按标签选择数据（如时间序列的日期索引）。

  - 需要包含结束标签的切片。

  - 基于列条件的布尔索引（更简洁）。

根据需求灵活选择，二者是 Pandas 数据操作的核心工具！

